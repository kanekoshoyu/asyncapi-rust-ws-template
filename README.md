[![AsyncAPI logo](./assets/logo_banner.png)](https://www.asyncapi.com)

# asyncapi-rust-ws-template
> npm project that converts AsyncAPI into rust websocket client crate 

![npm version](https://img.shields.io/npm/v/asyncapi-rust-ws-template.svg)
[![license](https://img.shields.io/github/license/kanekoshoyu/exchange-collection)](https://github.com/kanekoshoyu/exchange-collection/blob/master/LICENSE)
[![discord](https://img.shields.io/discord/1153997271294283827)](https://discord.gg/q3j5MYdwnm)
## design
- renderer: react rather than nunjucks, for its versatility. for details, click [here](https://www.asyncapi.com/docs/tools/generator/file-templates)
- generated code are derived as below:
  - client (server)
  - client function (channel)
  - client function logic (operation)
  - client function struct (model/schema)
- logic cases:
  - user transactionally send data to server
    - single [publish(v2) or receive(v3)]
    - no [subscribe(v2) or send(v3)]
    - optional single reply

## contents
| name                            | description                                                                                                   |
| ------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| [src/](/src/)                   | TypeScript source code, transpiles into `template` directory                                                  |
| [src/index.ts](/src/index.ts)   | transpiles to main template entry `template/index.js`, exposing the function for `asyncapi generator` command |
| [hooks/](/hooks/after.js)       | AsyncAPI hooks that cannot be processed by source                                                             |
| [template/](/template/)         | Javascript transcribed source code for template                                                               |
| [test/input](/test/)            | local test input, AsyncAPI document                                                                           |
| [test/output](/test/)           | local test output, rust client crate (git-ignore)                                                             |
| [package.json](/package.json)   | NPM package definition, defines template configs                                                              |
| [tsconfig.json](/tsconfig.json) | TypeScript transpile definition, defined transcribed datas                                                    |
| [CHANGELOG](/CHANGELOG.md)      | change log                                                                                                    |

## how to run terminal command
npm build, local YAML
```
ag sample/a.yaml "asyncapi-rust-ws-template" -o output -p validate=true -p render=true
```
local build, remote YAML
```
ag https://raw.githubusercontent.com/kanekoshoyu/exchange-collection/main/asset/binance_ws_asyncapi.yaml ./ -o output  -p validate=true -p render=true
```
local build, local YAML
```
ag sample/a.yaml ./ -o output -p validate=true -p render=true
```

## template input (AsyncAPI)
| spec                                      | requirement                                                                         |
| ----------------------------------------- | ----------------------------------------------------------------------------------- |
| format                                    | AsyncAPI v2.0.0+ (supports v3 as well)                                              |
| minimum content requirement for WS client | `info`, `servers`, `channels`, `components` , can be tested with `-p validate=true` |


## template parameters
| parameter   | options                                            | description                                                                   |
| ----------- | -------------------------------------------------- | ----------------------------------------------------------------------------- |
| `validate`  | `true` `false (default)`                           | to validate if a AsyncAPI has minimum content for generating websocket client |
| `render`    | `true` `false (default)`                           | to render a rust websocket client                                             |
| `framework` | `tokio-tungstenite (default)`, `async-tungstenite` | rust websocket client framework to render                                     |

## dev setup installation
install react
```
npm install react
```
install typescript transpiler
```
npm install @types/react --save-devnpm install typescript @types/node --save-dev
```

## template output (rust client crate)
The `rust` code generated by this template has the following structure
- `Cargo.toml` // using info
- `README.md` // using info
- `src/`
  - `lib.rs` // overall library
  - `client/`
    - `mod.rs`
    - `${client}.rs` // using servers, channels, operations
  - `model/`
    - `mod.rs`
    - `${message}.rs` // using components

## TODO
changelog: please check [here](./CHANGELOG.md)
- [x] design codegen structure
  - [x] study nunjucks vs react (decided to use react)
- [ ] code generation
  - [x] define code structure
  - [ ] websocket client function from `operation`
  - [ ] pubsub function from `channel`
  - [ ] fix modelina referencing other model as `crate::*`;
- [ ] code testing
  - [ ] unit test

## recruitment
#### TypeScript AsyncAPI Template Developer
I am not a TS expert, so I would love to have an expert to accelarate development for websocket genrator in the following output languages:
- `typescript`, `go`, `python`  

## see also
- [guilder](https://github.com/kanekoshoyu/guilder) - Unopinionated Cross-Exchange Crypto Trading Library
- [exchange-collection](https://github.com/kanekoshoyu/exchange-collection) - Crypto Exchange OpenAPI(REST) / AsyncAPI(WS) and Clients
- [kucoin-arbitrage](https://github.com/kanekoshoyu/kucoin_arbitrage) - KuCoin Cyclic Arbitrage, in Tokio Rust (legacy)

